# 제 2장. 데이터 모델과 성능

[DATA ON-AIR] 사이트 참조

### 1. 성능 데이터 모델링 정의

: 데이터베이스 성능 향상을 목적으로 설계 단계의 데이터 모델링 때부터 성능과 관련된 사항이 모델링에 반영될 수 있도록 하는 것

👉 정규화, 반정규화, 테이블 통합, 테이블 분할, 조인구조, PK, FK 등

### 2. 성능 데이터 모델링 수행 시점

‼ 분석/ 설계 단계에서 데이터 모델 성능을 고려한 데이터 모델링 수행할 경우 성능 저하에 따른 재업무 비용을 최소화 할 수 있는 기회를 가지게 된다.

⇒ 처음부터 성능 따져서 만들어야 비용이 최소화 된다.

⇒ 분석/ 설계 단계에서 데이터 모델 대충하고, 성능 저하되는 문장 튜닝하면 나중에 돈 더 든다.

⇒ 특히, 데이터 증가가 빠르면 빠를수록 성능 저하에 따른 성능 개선 비용이 증가한다.

### 3. 성능 데이터 모델링 고려사항

**1) 데이터 모델링을 할 때 정규화를 정확하게 수행한다.**

⇒ 정규화된 모델이 데이터를 관심사별로 분산시키는 효과가 있어 그 자체로 성능 향상 가능

`정규화 : 개체에 존재하는 함수적 종속 관계를 이용하는 DB 구조를 안정화시키는 작업`

**2) 데이터베이스 용량 산정을 수행한다.**

⇒ 어떤 엔터티(테이블)에 데이터 집중되는지 파악 가능

**3) 데이터베이스에 발생되는 트랜잭션의 유형을 파악한다.**

⇒ SQL 문장의 조인관계 테이블에서 데이터 조회 칼럼 파악 가능

**4) 용량과 트랜잭션의 유형에 따라 반정규화를 수행한다.**

⇒ 테이블, 속성, 관계에 대해 포괄적인 반정규화 방법 적용 필요

**5) 이력 모델의 조정, PK/FK 조정, 슈퍼타입/서브타입 조정 등을 수행한다.**

⇒ PK/FK를 성능 우수한 순서대로 칼럼 순서 조정 필요(영향도 ↑)

**6) 성능 관점에서 데이터 모델을 검증한다.**

⇒ 일반적인 데이터 모델 규칙 뿐만 아니라 충분한 성능 고려 체크리스트 포함 검증 필요

### 4. 정규화를 통한 성능 향상 전략

‼ 정규화된 테이블은 데이터를 처리할 때 속도가 빨라질 수 있고, 느려질 수도 있는 특성 존재

![Untitled](%E1%84%8C%E1%85%A6%202%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%E1%84%80%E1%85%AA%20%E1%84%89%E1%85%A5%E1%86%BC%E1%84%82%E1%85%B3%E1%86%BC%20d81f65951612478291352bfe5d86c6cb/Untitled.png)

❕정규화 👍 → 입력/ 수정/ 삭제 성능 향상    

❕ 반정규화 👍 → 조회 성능 향상

‼ 반정규화 만이 조회 성능을 향상시킨다⁉ ( ❌ ) 

→ 정규화를 통해 성능 저하되기도 하고, 정규화를 통해 성능 향상되는 경우도 있음

### 5. 함수적 종속성(Functional Dependency)에 근거한 정규화 수행 필요

▪함수의 종속성 : 데이터들이 어떤 기준값에 의해 종속되는 현상을 지칭

❕ 기준값 = 결정자 / 종속되는 값 = 종속자

▪정규화 

: 데이터가 꼬이는 것을 막기 위해 테이블을 잘게 나누는 것

: (목적) 반복적인 데이터를 분리하고 각 데이터가 종속된 테이블에 적절하게 배치하는 것

: 프로젝트 수행에서 정규화는 선택 사항이 아닌 필수 사항

— 1차 정규화 : 같은 성격, 내용 컬럼이 연속될 때 컬럼 제거, 테이블 생성

— 2차 정규화 : PK 복합키 구성일 때 부분적 함수 종속 관계 테이블 분리

— 3차 정규화 : PK가 아닌 일반 컬럼에 의존하는 컬럼 분리

### 6. 반정규화를 통한 성능향상 전략

### 가. 반정규화의 정의

: 정규화된 엔터티, 속성, 관계에 대해 시스템 성능 향상과 개발, 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링 기법

: 성능 향상을 위해 정규화를 포기하는 것, 

but 데이터 무결성이 보장 되지 않으므로 제한적으로 사용해야 함.

‼ (적용 이유) 데이터 조회 시 디스크 I/O가 많거나 경로가 너무 멀어 조인으로 인한 성능 저하, 칼럼 계산하여 읽을 때 성능 저하되는 경우 반정규화 수행

![Untitled](%E1%84%8C%E1%85%A6%202%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%E1%84%80%E1%85%AA%20%E1%84%89%E1%85%A5%E1%86%BC%E1%84%82%E1%85%B3%E1%86%BC%20d81f65951612478291352bfe5d86c6cb/Untitled%201.png)

‼ 기본적으로 정규화는 입력/ 수정/ 삭제, 조회에 대하여 성능 향상

‼                     반정규화는 여러 개의 조인이 걸려야만 하는 경우 사용

### 나. 반정규화 적용 방법

1) 반정규화 대상 조사

‼ (범위 처리 빈도수 조사) 자주 사용되는 테이블에 접근하는 프로세스가 많고 항상 일정한 범위만 조회하는 경우에 반정규화 검토 

‼ (대량 범위 처리 조사) 대량의 데이터 존재, 대량 데이터 범위 처리하는 경우 처리 범위를 일정하게 줄이지 않으면 성능 보장 못할 경우

‼ (통계성 프로세스 조사) 통계 정보 필요 시 별도 통계테이블(반정규화 테이블) 생성

‼ (테이블 조인 개수) 많은 조인이 걸려 데이터 조회 작업이 기술적으로 어려울 경우 반정규화 검토

2) 다른 방법 유도 검토

‼ (뷰(VIEW) 테이블) 많은 조인이 걸려 데이터 조회 작업이 기술적으로 어려울 경우 뷰(view) 사용하여 해결

‼ (클러스터링 적용) 대량 데이터를 특정 클러스터링 팩트에 의해 저장 방식을 다르게 하는 방법 _ 조회 중심인 경우

‼ (인덱스 조정_파티셔닝 기법) 물리적인 저장 기법

‼ (응용애플리케이션) 로직 구사 방법 변경_캐쉬 등

3) 반정규화 적용

‼ 테이블 반정규화

‼ 속성 반정규화

‼ 관계 반정규화

### 7. 반정규화의 기법

### 가. 테이블 반정규화

▪ 테이블 병합

1) 1:1 관계 테이블 병합 : 1:1 관계를 통합하여 성능 향상

2) 1:M 관계 테이블 병합 : 1:M 관계를 통합하여 성능 향상

3) 슈퍼/ 서브 관계를 통합하여 성능 향사

▪ 테이블 분할

1) 수직 분할 

: 칼럼 단위 테이블 디스크 I/O를 분산처리 하기 위해 테이블을 1:1로 분리하여 성능 향상

2) 수평 분할

: 로우 단위로 집중 발생되는 트랜잭션을 분석하여 디스크 I/O 및 데이터 접근 효율성을 높여 성능 향상하기 위해 로우 단위로 테이블 쪼갬

▪ 테이블 추가

1) 중복 테이블 추가

: 동일한 테이블 구조 중복하여 원격 조인을 제거 후 성능 향상

2) 통계 테이블 추가

: SUM, AVG 등을 미리 수행하여 계산해 둠으로써 조회 시 성능 향상

3) 이력 테이블 추가

: 마스터 테이블에 존재하는 레코드를 중복하여 이력테이블에 존재시켜 성능 향상

4) 부분 테이블 추가

: 자주 이용하는 집중화 된 칼럼들이 있을 때 디스크 I/O를 줄이기 위해 해당 칼럼들을 모아 놓은 별도의 반정규화 테이블 생성

### 나. 칼럼 반정규화

▪ 중복 칼럼 추가

: 조인을 감소시키기 위해 중복된 칼럼 위치 시킴

▪ 파생 칼럼 추가

: 트랜잭션 처리 시점 계산에 의해 발생되는 성능 저하 예방 위해 미리 값을 계산하여 칼럼에 보관

▪ 이력테이블 칼럼 추가

: 이력 데이터 처리 시 불특정 날 조회나 최근 값을 조회할 때 발생되는 성능 저하 예방 위해 이력 테이블에 기능성 칼럼 추가

▪ PK에 의한 칼럼 추가

: 단일 PK 안에서 특정 값을 별도로 조회하는 경우 성능 저하 발생 가능성 있어 일반 속성으로 포함하는 방법

▪ 응용시스템 오작동 위한 칼럼 추가

: 업무적 의미 없으나 데이터 처리 시 잘못 처리하여 원래 값으로 복구하기 원하는 경우 이전 데이터를 임시적으로 중복하여 보관하는 기법

### 다. 관계 반정규화

▪ 중복 관계 추가 : 여러 경로를 거쳐 조인 가능하나 이 때 발생하는 성능 저하 예방 위해 추가적인 관계 맺는 방법